.form

  %h2 Album

  = form_for album, :html => { :multipart => true } do |f|
    = errors_for album

    .form_row
      = f.label :composer
      = select :album, :composer_id, Composer.find(:all, :order => :name).collect{|composer| [composer.name, composer.id]}

    .form_row
      = f.label :obra_type
      = select :album, :obra_type_id, ObraType.find(:all, :order => :name).collect{|obra_type| [obra_type.name, obra_type.id] }

    .form_row
      = f.label :name
      = f.text_field :name, :class => :text

    .form_row
      = f.label :music_tone
      = f.text_field :music_tone, :class => :text

    .form_row
      = f.label :obra_number
      = f.text_field :number, :class => :text

    .form_row
      = f.label :opus_number
      = f.text_field :opus_number, :class => :text

    .form_row
      = f.label :instrument
      = select :album, :instrument_id, Instrument.find(:all, :order => :name).collect{|instrument| [instrument.name, instrument.id] }

    .form_row
      = f.label :solist
      = select :album, :solist_id, Solist.find(:all, :order => :name).collect{|solist| [solist.name, solist.id] }

    .form_row
      = f.label :director
      = select :album, :director_id, Director.find(:all, :order => :name).collect{|director| [director.name, director.id] }

    .form_row
      = f.label :orchestra
      = select :album, :orchestra_id, Orchestra.find(:all, :order => :name).collect{|orchestra| [orchestra.name, orchestra.id] }

    .form_row
      = f.label :cd_number
      = f.text_field :cd_number,:class => :text

    .form_row_submit
      = f.submit button_label, :class => 'button'

= link_to t(:back), albums_path

:javascript
    (function($) {
    $.widget("ui.combobox", {
    _create: function() {
    var self = this;
    var select = this.element.hide();
    var input = $("<input>")
    .insertAfter(select)
    .val(select[0].options[select[0].selectedIndex].text)
    .autocomplete({
    delay: 0,
    source: function(request, response) {
    var matcher = new RegExp(request.term, "i");
    response(select.children("option").map(function() {
    var text = $(this).text();
    if (this.value && (!request.term || matcher.test(text)))
    return {
    id: this.value,
    label: text.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)(" + $.ui.autocomplete.escapeRegex(request.term) + ")(?![^<>]*>)(?![^&;]+;)", "gi"), "$1"),
    value: text
    };
    }));
    },
    delay: 0,
    change: function(event, ui) {
    if (!ui.item) {
    // remove invalid value, as it didn't match anything
    $(this).val("");
    return false;
    }
    select.val(ui.item.id);
    self._trigger("selected", event, {
    item: select.find("[value='" + ui.item.id + "']")
    });

    },
    minLength: 0
    })
    .addClass("ui-widget ui-widget-content");
    $("<button>&nbsp;</button>")
    .attr("tabIndex", -1)
    .attr("title", "Show All Items")
    .insertAfter(input)
    .button({
    icons: {
    primary: "ui-icon-triangle-1-s"
    },
    text: false
    }).removeClass("ui-corner-all")
    .addClass("ui-corner-right ui-button-icon")
    .click(function() {
    // close if already visible
    if (input.autocomplete("widget").is(":visible")) {
    input.autocomplete("close");
    return;
    }
    // pass empty string as value to search for, displaying all results
    input.autocomplete("search", "");
    input.focus();
    return false;
    });
    }
    });

    })(jQuery);

    $(function() {
    $("#album_obra_type_id").combobox();
    $("#album_composer_id").combobox();
    $("#album_solist_id").combobox();
    $("#album_director_id").combobox();
    $("#album_orchestra_id").combobox();
    $("#album_instrument_id").combobox();
    });

